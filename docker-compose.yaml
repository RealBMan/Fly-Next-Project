#Generated by ChatGPT
#docker-compose.yaml


version: '3.8'

services:
  db:
    image: postgres:15
    container_name: flynext_db
    restart: always
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-flynextuser}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-flynextpass}
      POSTGRES_DB: ${POSTGRES_DB:-flynextdb}
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    networks:
      - flynext-net

  app:
    container_name: flynext_app
    build:
      context: .
      # If needed, uncomment and define build args:
      # args:
      #   NEXT_PUBLIC_API_BASE_URL: ${NEXT_PUBLIC_API_BASE_URL}
    restart: always
    depends_on:
      - db
    ports:
      - "3000:3000"
    environment:
      # Database connection string - uses Docker service name 'db' as host
      DATABASE_URL: postgresql://${POSTGRES_USER:-flynextuser}:${POSTGRES_PASSWORD:-flynextpass}@db:5432/${POSTGRES_DB:-flynextdb}?schema=public

      # JWT secrets (placeholder values here)
      JWT_SECRET: ${JWT_SECRET:-jwt_secret}
      JWT_REFRESH_SECRET: ${JWT_REFRESH_SECRET:-jwt_refresh_secret}
      JWT_EXPIRY: ${JWT_EXPIRY:-15m}
      JWT_REFRESH_EXPIRY: ${JWT_REFRESH_EXPIRY:-7d}

      # Bcrypt rounds
      BCRYPT_ROUNDS: ${BCRYPT_ROUNDS:-10}

      # AFS Configuration
      AFS_URL: ${AFS_URL:-https://advanced-flights-system.replit.app}
      AFS_KEY: ${AFS_KEY:-afs_key}

      # Next.js API base URL (for client to know where the server is)
      NEXT_PUBLIC_API_BASE_URL: ${NEXT_PUBLIC_API_BASE_URL:-http://localhost:3000/api}

      NODE_ENV: production
    networks:
      - flynext-net

networks:
  flynext-net:

volumes:
  postgres_data:
